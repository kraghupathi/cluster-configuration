#+TITLE:     The Cluster Model
#+AUTHOR:    M.S.Soumya
#+EMAIL:     ms@ms
#+DATE:      2015-03-25 Wed
#+PROPERTY: session *scratch*
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: org-templates/level-0.org

* Introduction
  This document describes in detail the model of systems cluster at
  VLEAD.  The tools, systems, configurations, setup files and related
  discussions have been captured in this model.

* The Cluster Model
  The cluster model is a set of systems which formulate the
  infrastructure for the hosting of labs.  There are other components
  which will be later added to this model.  This infrastructure is
  deployed at following different locations:
  + [[Base4 Cluster][Base4]]
  + [[Base1 Cluster][Base1]]
  + [[Amazon Web Services (AWS) Cluster][AWS]]
    
* Bootstrapping Cluster
  The cluster is a collection of several machines.  Each of these
  machines have a specific purpose that they serve.  +Each of these+
  +machines are called as nodes in the cluster.+  To setup the entire
  cluster for the first time we need to setup each of the machines
  individually.  This process is called the bootstrapping process.
  This process is tightly related to provisioning on corresponding cluster.
  
* Purpose of various deployments
** Base4 Cluster
   This cluster is the development cluster. This cluster is used to
   test new changes made to the develop branch before they are
   considered as stable.

** Base1 Cluster 
   Once set of new features are found to be stable on base4 cluster, a
   release is made.  The new release is then tested on base1 cluster
   to verify its soundness on staging environment. 
   
** Amazon Web Services (AWS) Cluster
   This cluster is the production cluster.  This cluster is modified
   at last after changes have been verified on both development and
   staging.  /It should be noted that ADS adapter used on base1 and/
   /base4 is different than adapter used on AWS.  Hence some problems/
   /may arise due to use of different adapter in production in/
   /comparison to staging and development./  This is the main cluster
   used by external virtual-labs users across the nation.

** Difference in the Base1 and AWS cluster
   Most of the components of base1 and base4 clusters are same as AWS
   cluster.  The main difference is in the provisioning.  The details of
   provisioning of these clusters is described in the next sections.

*** Provisioning of Base1 and Base4 cluster
*** Provisioning of AWS cluster

* Design of the Cluster model
  The diagram below depicts the architecture of the systems in the
  cluster model. This architecture does not change for the types of
  clusters mentioned earlier.  
  
** Overall Network Diagram
   The diagram below shows the architecture of the cluster. The
   network setup of the cluster is depicted in this figure.

   #+CAPTION:  Cluster Network Diagram
   #+LABEL:  fig-cluster-network-diagram
   #+NAME: fig-cluster-network-diagram
   [[./diagrams/overall-cluster-network-diagram.png]]
   
   In this diagram IP1 and IP2 refer to the only two public IPs being
   used by the system.  IP1 is the public IP assigned to router and
   IP2 is the public IP assigned to ansible.  Normal virtual-lab users
   only see and contact router.  VLEAD team uses ansible to manage the
   cluster.  In near future ADS interface will also be accessible via
   router, for all virtual-labs developers, perhaps through a
   different port.

** Overall connectivity Diagram
   The diagram below shows how the different machines in the are
   connected to each other. It just shows the connection of each
   machine with the other, not specifying the protocol or the port with
   which they connect.
   #+CAPTION:  Cluster connectivity Diagram
   #+LABEL:  fig-cluster-connectivity-diagram
   #+NAME: fig-cluster-connectivity-diagram
   [[./diagrams/overall-model-aws-cluster.png]]

* Nodes in the cluster
- [[./rsyslog_server.org][Rsyslog]]
- [[./privatedns.org][Private DNS]]
- [[./publicdns.org][Public DNS]]
- [[./rp-awstats.org][Reverse Proxy]]
- [[./nagios_server.org][Nagios]]
- [[./router.org][Router]]
- [[./rsnapshot_server.org][Backup server]]
- Ossec

