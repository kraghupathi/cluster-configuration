#+TITLE:     Analytics Server Role                                                                                                                                    
#+DATE:      2015-07-14 Tuesday                                                                                                                                     
#+PROPERTY: session *scratch*
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: org-templates/level-0.org
#+DESCRIPTION: Analytics Server Implementation Documentation
#+OPTIONS: ^:nil

* Introduction
  This documentation describes the requirements, design and
  implementation of analytics node(server). 

  The basic idea to build this node is to have all the webserver logs
  and awstats of each lab in one place. So that Analytics service uses
  these logs and serves usage of the labs on vlabs.ac.in web page.
  
* Requirement
  Requirements which are specific to analytics node are defined
  bellow and common requirements are defined in
  [[./common.org][common role]]
** Functional requirements
   1) Collect the web server(apache) logs and awstats logs for all the
      labs deployed on both AWS and IIITH infrastructure that are
      currently live(Production).
   2) Collect web server(apache) logs and awstats logs for all the
      labs that are not live.
      - Not live labs :: 
			 *Example 1*: Logs of the labs that were
                         resumed from deploy container on IIITH
                         infrastructure.
       
                         *Example 2*: Labs on aws which are stopped.
			 
      - NOTE :: Second(2) requirement is one time job. Once the
                required logs are collected from non live labs, no
                need to collect logs frequently as first(1)
                requirement.
   3) Allow incoming connections on tcp ports 80 and 443 to accept the
      web requests coming from the local subnet
   4) Available to the external world through domain name(URL).
** Security requirements
    1. Accept incoming connections on tcp port 22 from reverse proxy
       of aws cluster and iiith infrastructure in order to collect the
       logs using rsync command.
* Design
  This section describes the design to make this node functional, the
  implementation is explained in the following section.
  
  Two different sources, a reverse proxy on AWS cluster(Source 1) and
  a reverse proxy (http container)on the base machines in IIIT-H
  (Source 2). These sources are geographically located in different
  continents and on different network.

  Need a way of transferring the data(statistics, logs) in a secure
  manner to the analytics server where it will be processed. =rsync=
  is used to transfer, and setup periodic transfer jobs using =cronie=
  which executes every hour.
  
  As this task involves collecting data from two different sources,
  like a cluster which is managed with configuration management tool
  =Ansible= and another one a manually configured server.
  
  It is assumed that source node pushes the data to analytics
  node. For these assumptions, make changes to the reverse proxy model
  of the cluster and manually configure the reverse proxy at
  IIIT-H. These changes are described in respective node models, the
  gist, however, is this node will receive AWstats, apache log files
  every hour.

 
*** Re-configured AWS cluster, for the requirements of analytics node
    *Automated*::
    The following changes are done in reverse proxy node model and
    router node model.
    - Analytics server configured to accept =rsync= over =TCP=.
    - Reverse Proxy(Source 1) configured to push the generated
      statistics to =Analytics= server at regular intervals
    - Router configured to allow incoming =rsync= connections from
      Source 2(IIIT-H reverse proxy) to Analytics server

*** On BASE machines
    *Manual step*:: 
    
    Source 2 is located in IIITH infrastructure. In order to get logs
    from the source2 to analytics node, Add http_container's public
    key to the analytics node, Then source2 will be able to push the
    logs to analytics node on port 2222 using rsync command.
    - Reverse Proxy(Source 2) configured to push generated statistics to
   =Analytics= server every hour.
   #+BEGIN_EXAMPLE
   [root@http ~]# crontab -l
   #Rsync stats from http container to stats instance on AWS
   @hourly rsync -azR -e "ssh -p 2222" /var/www/awstats/awstats* stats.vlabs.ac.in:/root/base/
   @hourly rsync -azR -e "ssh -p 2222" /var/log/httpd/* stats.vlabs.ac.in:/root/base/
   #+END_EXAMPLE
** Network Diagram
*** Network diagram of analytics node
    The network diagram of analytics node in the cluster is
    represented below, it also shows how the node gets the web server
    logs, AWstats statistics files.
    [[./diagrams/analytics-node.png]]
*** Source file for the diagram
    The source file was prepared using Libreoffice 4.3 and VRT
    extensions.
    [[./diagrams/analytics-node.odg][Download source file]]
*** Location of apache logs and AWStats in analytics server
**** From Source1 
    - AWS reverse proxy server pushes the apache logs to analytics
      server's =/var/www/html/aws-logs/= location
    - AWS reverse proxy server pushes the awstats to analytics
      server's =/root/aws-awstats/= location.
**** From Source2
    - IIIT reverse proxy server is pushing the apache logs to analytics
      server's =/var/www/html/deploy-logs/= location
    - IIIT reverse proxy server is pushing the awstats to analytics
      server's =/root/base/deploy-awstats/= location

** Log files of each lab on Deploy Container
   - Pattern Name :: Collection of apache access logs of each lab.
 
   - Log File Name :: For each lab there might be many log files based
                      time/date. To have all the logs in single file,
                      merge those logs into one single log file.
  
   - Following table shows where the logs of each lab were getting
     stored before decommissioning the deploy container. Logs of each
     lab were stored at
     =/var/log/httpd/deploy.virtual-labs.ac.in-access*= in
     http_container(http.virtual-labs.ac.in).
    
   |------+-----------------------------------+--------------------------------------|
   | S.No | Pattern Name                      | Log File Name                        |
   |------+-----------------------------------+--------------------------------------|
   |    1 | deploy.virtual-labs.ac.in-access* | deploy.virtual-labs.ac.in-access_log |
   |------+-----------------------------------+--------------------------------------|

    The following table shows list of labs running from deploy
    container via http_container(http.virtual-labs.ac.in) before
    decommissioning the deploy container. The log files according to
    lab_id are actually generated from cronjob for grep command
    running on =/var/log/httpd/deploy.virtual-labs.ac.in-access*=.

    Check the cronjob for grep at =/etc/cron.hourly/= in
    http.virtual-labs.ac.in container

   |------+----------+-------------------------------------+----------------------------------------|
   | S.No | Lab ID   | Pattern Name                        | Log File Name                          |
   |------+----------+-------------------------------------+----------------------------------------|
   |    1 | cse01    | cse01.virtual-labs.ac.in-access*    | cse01.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    2 | cse02    | cse02.virtual-labs.ac.in-access*    | cse02.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    3 | cse03    | cse03.virtual-labs.ac.in-access*    | cse03.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    4 | cse04    | cse04.virtual-labs.ac.in-access*    | cse04.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    5 | cse05    | cse05.virtual-labs.ac.in-access*    | cse05.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    6 | cse06    | cse06.virtual-labs.ac.in-access*    | cse06.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    7 | cse07    | cse07.virtual-labs.ac.in-access*    | cse07.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    8 | cse08    | cse08.virtual-labs.ac.in-access*    | cse08.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |    9 | cse09    | cse09.virtual-labs.ac.in-access*    | cse09.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   10 | cse10    | cse10.virtual-labs.ac.in-access*    | cse10.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   11 | cse11    | cse11.virtual-labs.ac.in-access*    | cse11.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   12 | cse12    | cse12.virtual-labs.ac.in-access*    | cse12.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   13 | cse13    | cse13.virtual-labs.ac.in-access*    | cse13.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   14 | cse14    | cse14.virtual-labs.ac.in-access*    | cse14.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   15 | cse15    | cse15.virtual-labs.ac.in-access*    | cse15.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   16 | cse16    | cse16.virtual-labs.ac.in-access*    | cse16.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   17 | cse17    | cse17.virtual-labs.ac.in-access*    | cse17.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   18 | cse18    | cse18.virtual-labs.ac.in-access*    | cse18.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   19 | cse19    | cse19.virtual-labs.ac.in-access*    | cse19.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   20 | cse20    | cse20.virtual-labs.ac.in-access*    | cse20.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   21 | cse21    | cse21.virtual-labs.ac.in-access*    | cse21.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   22 | cse22    | cse22.virtual-labs.ac.in-access*    | cse22.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   23 | cse23    | cse23.virtual-labs.ac.in-access*    | cse23.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   24 | cse24    | cse24.virtual-labs.ac.in-access*    | cse24.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   25 | cse25    | cse25.virtual-labs.ac.in-access*    | cse25.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   26 | cse26    | cse26.virtual-labs.ac.in-access*    | cse26.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   27 | cse27    | cse27.virtual-labs.ac.in-access*    | cse27.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   28 | cse28    | cse28.virtual-labs.ac.in-access*    | cse28.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   29 | cse29    | cse29.virtual-labs.ac.in-access*    | cse29.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   30 | cse30    | cse30.virtual-labs.ac.in-access*    | cse30.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   31 | ece01    | ece01.virtual-labs.ac.in-access*    | ece01.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   32 | ece02    | ece02.virtual-labs.ac.in-access*    | ece02.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   33 | ece03    | ece03.virtual-labs.ac.in-access*    | ece03.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   34 | ece04    | ece04.virtual-labs.ac.in-access*    | ece04.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   35 | ece05    | ece05.virtual-labs.ac.in-access*    | ece05.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   36 | ece06    | ece06.virtual-labs.ac.in-access*    | ece06.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   37 | ece07    | ece07.virtual-labs.ac.in-access*    | ece07.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   38 | ece08    | ece08.virtual-labs.ac.in-access*    | ece08.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   39 | ece09    | ece09.virtual-labs.ac.in-access*    | ece09.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   40 | ece10    | ece10.virtual-labs.ac.in-access*    | ece10.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   41 | ece11    | ece11.virtual-labs.ac.in-access*    | ece11.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   42 | bio15    | bio15.virtual-labs.ac.in-access*    | bio15.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   43 | bio16    | bio16.virtual-labs.ac.in-access*    | bio16.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   44 | ccnsb01  | ccnsb01.virtual-labs.ac.in-accesss* | ccnsb01.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   45 | ccnsb02  | ccnsb02.virtual-labs.ac.in-access*  | ccnsb02.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   46 | ccnsb03  | ccnsb03.virtual-labs.ac.in-access*  | ccnsb03.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   47 | ccnsb04  | ccnsb04.virtual-labs.ac.in-access*  | ccnsb04.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   48 | ccnsb05  | ccnsb05.virtual-labs.ac.in-access*  | ccnsb05.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   49 | ccnsb06  | ccnsb06.virtual-labs.ac.in-access*  | ccnsb06.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |   50 | ccnsb07  | ccnsb07.virtual-labs.ac.in-access*  | ccnsb07.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   51 | chem01   | chem01.virtual-labs.ac.in-access*   | chem01.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   52 | civil09  | civil09.virtual-labs.ac.in-access*  | civil09.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   53 | civil13  | civil13.virtual-labs.ac.in-access*  | civil13.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   54 | civil15  | civil15.virtual-labs.ac.in-access*  | civil15.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   55 | civil16  | civil16.virtual-labs.ac.in-access*  | civil16.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   56 | engg01   | engg01.virtual-labs.ac.in-access*   | engg01.virtual-labs.ac.in-access_log   |
   |      |          |                                     |                                        |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   57 | hss01    | hss01 virtual-labs.ac.in-access*    | hss01 virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   58 | hss02    | hss02.virtual-labs.ac.in-access*    | hss02.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   59 | hss03    | hss03.virtual-labs.ac.in-access*    | hss03.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   60 | mech01   | mech01.virtual-labs.ac.in-access*   | mech01.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   61 | mech04   | mech04.virtual-labs.ac.in-access*   | mech04.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   62 | mech17   | mech17.virtual-labs.ac.in-access*   | mech17.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   63 | mech18   | mech18.virtual-labs.ac.in-access*   | mech18.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |   64 | phy14    | phy14.virtual-labs.ac.in-access*    | phy14.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |   65 | phy19    | phy19.virtual-labs.ac.in-access*    | phy19.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |   66 | sample1  | sample1.virtual-labs.ac.in-access*  | sample1.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   67 | sample13 | sample13.virtual-labs.ac.in-access* | sample13.virtual-labs.ac.in-access_log |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   68 | sample16 | sample16.virtual-labs.ac.in-access* | sample16.virtual-labs.ac.in-access_log |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   69 | sample2  | sample2.virtual-labs.ac.in-access*  | sample2.virtual-labs.ac.in-access_log  |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   70 | sample20 | sample20.virtual-labs.ac.in-access* | sample20.virtual-labs.ac.in-access_log |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   71 | sample21 | sample21.virtual-labs.ac.in-access* | sample21.virtual-labs.ac.in-access_log |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   72 | ece18    | ece18.virtual-labs.ac.in-access*    | ece18.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   73 | ece19    | ece19.virtual-labs.ac.in-access*    | ece19.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   74 | ece21    | ece21.virtual-labs.ac.in-access*    | ece21.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   75 | ece26    | ece26.virtual-labs.ac.in-access*    | ece26.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   76 | eee03    | eee03.virtual-labs.ac.in-access*    | eee03.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   77 | eee05    | eee05.virtual-labs.ac.in-access*    | eee05.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   78 | eee07    | eee07.virtual-labs.ac.in-access*    | eee07.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   79 | eee08    | eee08.virtual-labs.ac.in-access*    | eee08.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   80 | eee09    | eee09.virtual-labs.ac.in-access*    | eee09 .virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   81 | eee10    | eee10.virtual-labs.ac.in-access*    | eee10.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   82 | eee12    | eee12.virtual-labs.ac.in-access*    | eee12.virtual-labs.ac.in-access_log    |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   83 | eerc01   | eerc01.virtual-labs.ac.in-access*   | eerc01.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   84 | eerc02   | eerc02.virtual-labs.ac.in-access*   | eerc02.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   85 | eerc03   | eerc03.virtual-labs.ac.in-access*   | eerc03.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   86 | eerc04   | eerc04.virtual-labs.ac.in-access*   | eerc04.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   87 | eerc05   | eerc05.virtual-labs.ac.in-access*   | eerc05.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   88 | eerc06   | eerc06.virtual-labs.ac.in-access*   | eerc06.virtual-labs.ac.in-access_log   |
   |------+----------+-------------------------------------+----------------------------------------|
   |      |          |                                     |                                        |
   |   89 | emt      | emt.virtual-labs.ac.in-access*      | emt.virtual-labs.ac.in-access_log      |
   |------+----------+-------------------------------------+----------------------------------------|

** Log files of each lab hosted on IIIT Infrastructure
   The following table shows the labs that are hosted on IIIT
   infrastructure. These labs are actually moved from deploy container
   and hosted in separate containers.
   
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   | S.no | Lab ID  | Lab Name               | Pattern Name                          | Log File name                         |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    1 | cse04   | Problem                | cse04.virtual-labs.ac.in-access_log   | cse04.virtual-labs.ac.in-access_log   |
   |      |         | Solving                |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    2 | cse06   | Data Mining            | cse06.virtual-labs.ac.in-access_log   | cse06.virtual-labs.ac.in-access_log   |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    3 | cse07   | Databases              | cse07.virtual-labs.ac.in-access_log   | cse07.virtual-labs.ac.in-access_log   |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    4 | cse09   | Linux Lab              | cse09.virtual-labs.ac.in-access_log   | cse09.virtual-labs.ac.in-access_log   |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    5 | cse05   | Principles of          | cse05.virtual-labs.ac.in-access_log   | cse05.virtual-labs.ac.in-access_log   |
   |      |         | Programming            |                                       |                                       |
   |      |         | Languages              |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    6 | cse13   | Advanced VLSI          | cse13.virtual-labs.ac.in-access_log   | cse13.virtual-labs.ac.in-access_log   |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |      | cse16   | Speech Signal          | cse16.virtual-labs.ac.in-access_log   | cse16.virtual-labs.ac.in-access_log   |
   |    7 |         | Processing             |                                       |                                       |
   |      |         | (IIIT-H)               |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    8 | cse17   | Mobile Robotics        | cse17.virtual-labs.ac.in-access_log   | cse17.virtual-labs.ac.in-access_log   |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |    9 | cse21   | Optical Remote         | cse21.virtual-labs.ac.in-access_log   | cse21.virtual-labs.ac.in-access_log   |
   |      |         | Sensing                |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |      | cse24   | Natural Language       | cse24.virtual-labs.ac.in-access_log   | cse24.virtual-labs.ac.in-access_log   |
   |   10 |         | Processing             |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |      | cse30   | Analog CMOS VLSI       | cse30.virtual-labs.ac.in-access_log   | cse30.virtual-labs.ac.in-access_log   |
   |   11 |         | Circuit Design         |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   12 | eerc02  | Soil Mechanics         | eerc02.virtual-labs.ac.in-access_log  | eerc02.virtual-labs.ac.in-access_log  |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   13 | eerc04  | Basic Structural       | eerc04.virtual-labs.ac.in-access_log  | eerc04.virtual-labs.ac.in-access_log  |
   |      |         | Analysis               |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   14 | eerc05  | Geotechnical           | eerc05.virtual-labs.ac.in-access_log  | eerc05.virtual-labs.ac.in-access_log  |
   |      |         | Engineering Lab        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   15 | cse23   | Computational          | cse23.virtual-labs.ac.in-access_log   | cse23.virtual-labs.ac.in-access_log   |
   |      |         | Linguistics            |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   16 | cse10   | Computer               | cse10.virtual-labs.ac.in-access_log   | cse10.virtual-labs.ac.in-access_log   |
   |      |         | Organization and       |                                       |                                       |
   |      |         | Architecture           |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   17 | civil13 | Urban Transportation   | civil13.virtual-labs.ac.in-access_log | civil13.virtual-labs.ac.in-access_log |
   |      |         | Systems Planning       |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   18 | ccnsb01 | Molecular Fluorescence | ccnsb01.virtual-labs.ac.in-access_log | ccnsb01.virtual-labs.ac.in-access_log |
   |      |         | Spectroscopy           |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   19 | ccnsb02 | Colloid and Surface    | ccnsb02.virtual-labs.ac.in-access_log | ccnsb02.virtual-labs.ac.in-access_log |
   |      |         | Chemistry              |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   20 | ccnsb03 | Molecular Absorption   | ccnsb03.virtual-labs.ac.in-access_log | ccnsb03.virtual-labs.ac.in-access_log |
   |      |         | Spectroscopy           |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   21 | ccnsb04 | Quantum Chemistry      | ccnsb04.virtual-labs.ac.in-access_log | ccnsb04.virtual-labs.ac.in-access_log |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   22 | ccnsb05 | Circular Dichroism     | ccnsb05.virtual-labs.ac.in-access_log | ccnsb05.virtual-labs.ac.in-access_log |
   |      |         | Spectroscopy           |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   23 | ccnsb07 | Molecular              | ccnsb07.virtual-labs.ac.in-access_log | ccnsb07.virtual-labs.ac.in-access_log |
   |      |         | Interactions           |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |   24 | cse28   | Advanced Network       | cse28.virtual-labs.ac.in-access_log   | cse28.virtual-labs.ac.in-access_log   |
   |      |         | Technologies           |                                       |                                       |
   |      |         |                        |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |      | cse08   | Software               | cse08.virtual-labs.ac.in-access_log   | cse08.virtual-labs.ac.in-access_log   |
   |   25 |         | Engineering            |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   |      | civil11 | Virtual Satellite      |                                       |                                       |
   |      |         | Image Processing and   |                                       |                                       |
   |      |         | Analysis               |                                       |                                       |
   |------+---------+------------------------+---------------------------------------+---------------------------------------|
   
** Log files of each lab hosted on AWS
   List of labs running on AWS. Apache and awstats logs for each lab
   being stored in aws reverse proxy node in =/var/log/httpd/= and
   =/var/lib/awstats/= respectively.
   
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   | S.no | Lab id       | Lab Name                                                                         | Log Pattern                                  | Log File Name                                   |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    1 | cse01        | Data Structures                                                                  | cse01-iiith.virtual-labs.ac.in-access*       | cse01-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    2 | cse02        | Computer programming                                                             | cse02-iiith.virtual-labs.ac.in-access*       | cse02-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    3 | cse15        | DLD                                                                              | cse15-iiith.virtual-labs.ac.in-access*       | cse15-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    4 | cse19        | Image processing                                                                 | cse19-iiith.virtual-labs.ac.in-access*       | cse19-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    5 | cse18        | Computer Graphics                                                                | cse18-iiith.virtual-labs.ac.in-access*       | cse18-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    6 | cse20        | Pattern recognition                                                              | cse20-iiith.virtual-labs.ac.in-access*       | cse20-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    7 | emt          | EMT                                                                              | emt-iiith.virtual-labs.ac.in-access*         | emt-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    8 | cse29        | Cryptography                                                                     | cse29-iiith.virtual-labs.ac.in-access*       | cse29-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |    9 | cse22        | Artificial Nueral Networks                                                       | cse22-iiith.virtual-labs.ac.in-access*       | cse22-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   10 | cse11        | CO                                                                               | cse11-iiith.virtual-labs.ac.in-access*       | cse11-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   11 | cse14        | VLSI                                                                             | cse14-iiith.virtual-labs.ac.in-access*       | cse14-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   12 | eerc03       | Hydraulics and fluid mechanics                                                   | eerc03-iiith.virtual-labs.ac.in-access*      | eerc03-iiith.virtual-labs.ac.in-access_log      |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   13 | phy14        | Physical Sciences                                                                | phy14-iiith.virtual-labs.ac.in-access*       | phy14-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   14 | ccnsb06      | Physical chemistry                                                               | ccnsb06-iiith.virtual-labs.ac.in-access*     | ccnsb06-iiith.virtual-labs.ac.in-access_log     |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   15 | eerc01       | Engineering Mechanics And SOM                                                    | eerc01-iiith.virtual-labs.ac.in-access*      | eerc01-iiith.virtual-labs.ac.in-access_log      |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   16 | csc          | Colloid and Surface Chemistry Virtual Lab                                        | csc-iiith.virtual-labs.ac.in-access*         | csc-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   17 | bsa          | Basic Structural Analysis                                                        | bsa-iiith.virtual-labs.ac.in-access*         | bsa-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   18 | cds          | Circular Dichronism Spectroscopy                                                 | cds-iiith.virtual-labs.ac.in-access*         | cds-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   19 | smfe         | Soil Mechanics and Foundation Engineering                                        | cse01-iiith.virtual-labs.ac.in-access*       | cse01-iiith.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   20 | ssp          | Speech Signal Processing                                                         | ssp-iiith.virtual-labs.ac.in-access*         | ssp-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   21 | sd           | Structural Dynamics                                                              | sd-iiith.virtual-labs.ac.in-access*          | sd-iiith.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   22 | cl           | Computational Linguistics                                                        | cl-iiith.virtual-labs.ac.in-access*          | cl-iiith.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   23 | ge           | Geotechnical Engineering                                                         | ge-iiith.virtual-labs.ac.in-access*          | ge-iiith.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   24 | mi           | Molecular Interactions                                                           | mi-iiith.virtual-labs.ac.in-access*          | mi-iiith.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   25 | mas          | Molecular Absorption Spectroscopy                                                | mas-iiith.virtual-labs.ac.in-access*         | mas-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   26 | mfs          | Molecular Florescence Spectroscopy                                               | mfs-iiith.virtual-labs.ac.in-access*         | mfs-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   27 | nlp          | Natural Language Processing                                                      | nlp-iiith.virtual-labs.ac.in-access*         | nlp-iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   28 | cp           | Computer Programming Responsive                                                  | cp -iiith.virtual-labs.ac.in-access*         | cp -iiith.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   29 | ps           | Problem Solving Lab                                                              | ps-iiith.virtual-labs.ac.in-access*          | ps-iiith.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   30 | ssl          | Signals And Systems Laboratory                                                   | ssl-iitg.virtual-labs.ac.in-access*          | ssl-iitg.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   31 | bmi          | Bio-Medical Instrumentation Lab                                                  | bmi-iitr.virtual-labs.ac.in-access*          | bmi-iitr.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   32 | bmsip        | Bio-medical signal and image processing lab                                      | bmsip-iitr.virtual-labs.ac.in-access*        | bmsip-iitr.virtual-labs.ac.in-access_log        |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   33 | em           | Elecrical Machines Lab                                                           | em-iitr.virtual-labs.ac.in-access*           | em-iitr.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   34 | sl           | Surveying Lab                                                                    | sl-iitr.virtual-labs.ac.in-access*           | sl-iitr.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   35 | mrmsmtbs     | Material Response to Micro Structural, Mechanical,Thermal and Biological Stimuli | mrmsmtbs-iitk.virtual-labs.ac.in-access*     | mrmsmtbs-iitk.virtual-labs.ac.in-access_log     |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   36 | va           | Virtual Astrophysica Lab                                                         | va-iitk.virtual-labs.ac.in-access*           | va-iitk.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   37 | ufls         | Ultra fast Laser Spectroscopy Lab                                                | ufls-iitk.virtual-labs.ac.in-access*         | ufls-iitk.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   38 | vlae         | Virtual Lab Aerospace Engineering                                                | vlae-iitk.virtual-labs.ac.in-access*         | vlae-iitk.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   39 | vcal         | Virtual Combustion and Automization Lab                                          | vcal-iitk.virtual-labs.ac.in-access*         | vcal-iitk.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   40 | pev          | Population Ecology Virtual Lab I                                                 | pev-au.virtual-labs.ac.in-access*            | pev-au.virtual-labs.ac.in-access_log            |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   41 | pevii        | Population Ecology Virtual Lab II                                                | pevii-au.virtual-labs.ac.in-access*          | pevii-au.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   42 | anthropology | Virtual Anthropology Lab                                                         | anthropology-iitg.virtual-labs.ac.in-access* | anthropology-iitg.virtual-labs.ac.in-access_log |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   43 | ergonomics   | Virtual Ergonomics Lab                                                           | ergonomics-iitg.virtual-labs.ac.in-access*   | ergonomics-iitg.virtual-labs.ac.in-access_log   |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   44 | vem          | Virtual Electrical Machine Lab                                                   | vem-iitg.virtual-labs.ac.in-access*          | vem-iitg.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   45 | ve           | Virtual English & Communication Lab                                              | ve-iitg.virtual-labs.ac.in-access*           | ve-iitg.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   46 | ial          | Industrial Automation Laboratory                                                 | ial-coep.virtual-labs.ac.in-access*          | ial-coep.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   47 | sl           | Virtual Sensor Lab                                                               | sl-coep.virtual-labs.ac.in-access*           | sl-coep.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   48 | plc          | Virtual Programmable Logic Controller Lab                                        | plc-coep.virtual-labs.ac.in-access*          | plc-coep.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   49 | em           | Virtual Electrical Machines Lab                                                  | em-coep.virtual-labs.ac.in-access*           | em-coep.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   50 | va           | Virtual Vibrations & Acoustics Lab                                               | va-coep.virtual-labs.ac.in-access*           | va-coep.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   51 | mm           | Virtual Micro Machining Laboratory                                               | mm-coep.virtual-labs.ac.in-access*           | mm-coep.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   52 | fab          | Virtual FAB Laboratory                                                           | fab-coep.virtual-labs.ac.in-access*          | fab-coep.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   53 | bmsp         | Virtual Bio-Medical & Signal Processing Laboratory                               | bmsp-coep.virtual-labs.ac.in-access*         | bmsp-coep.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   54 | he           | Virtual Hybrid Elecronics Lab                                                    | he-coep.virtual-labs.ac.in-access*           | he-coep.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   55 | ied          | Virtual Industrial Electrical Drives Lab                                         | ied-nitk.virtual-labs.ac.in-access*          | ied-nitk.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   56 | sa           | Virtual Substration Automation Lab                                               | sa-nitk.virtual-labs.ac.in-access*           | sa-nitk.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   57 | fm           | Virtual Fluid Mechanics Lab                                                      | fm-nitk.virtual-labs.ac.in-access*           | fm-nitk.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   58 | sm           | Virtual Strength of Materials Lab                                                | sm-nitk.virtual-labs.ac.in-access*           | sm-nitk.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   59 | mm           | Virtual Mechanics of Machine Lab                                                 | mm-nitk.virtual-labs.ac.in-access*           | mm-nitk.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   60 | mdmv         | Machine Dynamics and Vibration Lab                                               | mdmv-nitk.virtual-labs.ac.in-access*         | mdmv-nitk.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   61 | uorepc       | Process Control, Reaction Engineering and Unit Operations Lab                    | uorepc-nitk.virtual-labs.ac.in-access*       | uorepc-nitk.virtual-labs.ac.in-access_log       |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   62 | vssd         | Virtual smart Structures and Dynamics Lab                                        | vssd-iitd.virtual-labs.ac.in-access*         | vssd-iitd.virtual-labs.ac.in-access_log         |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   63 | qnm          | Queueing networks modelling lab                                                  | qnm-iitd.virtual-labs.ac.in-access*          | qnm-iitd.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   64 | eem          | Engineering Electro-magnetics Lab                                                | eem-iitd.virtual-labs.ac.in-access*          | eem-iitd.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   65 | msvs         | Metal Forming Virtual Simulation Lab                                             | msvs-dei.virtual-labs.ac.in-access*          | msvs-dei.virtual-labs.ac.in-access_log          |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   66 | vp           | Virtual Power Lab                                                                | vp-dei.virtual-labs.ac.in-access*            | vp-dei.virtual-labs.ac.in-access_log            |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   67 | vc           | Virtual Chemistry Lab                                                            | vc-dei.virtual-labs.ac.in-access*            | vc-dei.virtual-labs.ac.in-access_log            |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   68 | pe           | Virtual Proteomics Laboratory                                                    | pe-iitb.virtual-labs.ac.in-access*           | pe-iitb.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   69 | ce           | Chemical Engineering Lab                                                         | ce-iitb.virtual-labs.ac.in-access*           | ce-iitb.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|
   |   70 | ee           | Electronics Devices and Circuits                                                 | ee-iitb.virtual-labs.ac.in-access*           | ee-iitb.virtual-labs.ac.in-access_log           |
   |------+--------------+----------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------------------|

* Implementation
** Structure of Scripts

#+BEGIN_EXAMPLE
roles/analytics_server
|-- files
|   `-- analytics_http.conf
|-- handlers
|   `-- main.yaml
|-- tasks
|   `-- main.yaml
`-- templates
    `-- analytics_server_iptables
#+END_EXAMPLE

** Firewall Rules
   In addition to common firewall rules, this node allows incoming TCP
   port 22 connections from reverse proxy, for copying logs from
   reverse proxy.

#+BEGIN_SRC yml :tangle roles/analytics_server/templates/analytics_server_iptables :eval no
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
#Accept loopback connections
-A INPUT -i lo -d 127.0.0.0/8 -j ACCEPT
#Rate limit new connections to 20 new connections per 30 seconds
-A INPUT ! -p udp -m state --state NEW -m recent --name new_limit --set
-A INPUT ! -p udp -m state --state NEW -m recent --name new_limit --rcheck --seconds 30 --hitcount 20 -m limit --limit 2/min -j LOG --log-prefix "new_limit_"
-A INPUT ! -p udp -m state --state NEW -m recent --name ssh_limit --rcheck --seconds 30 --hitcount 20 -j DROP
#Accept ICMP ping requests at limited rate
-A INPUT -p icmp --icmp-type echo-request -m limit --limit 60/minute --limit-burst 120 -j ACCEPT
-A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/minute --limit-burst 2 -j LOG
-A INPUT -p icmp --icmp-type echo-request -j DROP
#Allow ongoing connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
#Allow incoming SSH connections from ansible server IPs.
{% for item in ansible_server_ips  %}
-A INPUT -m state --state NEW -s {{item}} -p tcp -m tcp --dport 22 -j ACCEPT
{% endfor %}
#Allow incoming connections from reverse proxy server on TCP port 22
-A INPUT -m state --state NEW -s {{reverseproxy_ip}} -p tcp -m tcp --dport 22 -j ACCEPT
#Allow TCP port 22 connections from rsnapshot backup server
{% for item in rsnapshot_server_ips %}
-A INPUT -s {{item}} -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
{% endfor %}
# Allow incoming http packets from local subnet via the router
-A INPUT -s {{local_subnet}} -p tcp -m tcp --dport 80 -j ACCEPT
#Allow incoming connections from http container on base on TCP port 22
-A INPUT -m state --state NEW -s {{http_container}} -p tcp -m tcp --dport 22 -j ACCEPT
#Allow incoming NRPE queries for nagios from nagios servers
-A INPUT -m state --state NEW -p tcp -m tcp --dport 5666 -j ACCEPT
#Allow SNMP queries from cacti servers
-A INPUT -p udp -m udp --dport 161 -j ACCEPT
-A INPUT -p udp -m udp --dport 162 -j ACCEPT
#Log all other "blocked_input_" attempts with rate limiting
-A INPUT -m state --state NEW -m limit --limit 2/min -j LOG --log-prefix "blocked_input_"
#Reply with proper ICMP error message and reject the connection
-A INPUT -j REJECT --reject-with icmp-host-prohibited
#Disable packet forwarding
-A FORWARD -j REJECT
#########Output rules############
#Allow outgoing connections to localhost
-A OUTPUT -s 127.0.0.0/8 -o lo -j ACCEPT
#Allow ongoing connections
-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
#Allow DNS queries
-A OUTPUT -p udp -m udp --dport 53 -j ACCEPT
#Allow server to send emails.  Required for sending logwatch emails
-A OUTPUT -p tcp -m tcp --dport 25 -j ACCEPT
#Allow server to contact web-servers.  This is must for reverseproxy to be able to forward requests to internal web servers
-A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A OUTPUT -p tcp -m tcp --dport 443 -j ACCEPT
#Allow outgoing ping requests
-A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT
#Allow outgoing connections to rsyslog server
-A OUTPUT -p udp -m udp --dport 514 -j ACCEPT
#Allow outgoing connections to OSSEC server
-A OUTPUT -p udp -m udp --dport 1514 -j ACCEPT
#Log all other "blocked_output_" attempts
-A OUTPUT -m state --state NEW -m limit --limit 2/min -j LOG --log-prefix "blocked_output_"
#Allow outgoing connections on tcp port 8000 to internal subnet, this is for bandwidthd on router
-A OUTPUT -p tcp -m tcp -d {{router_internal_ip}} --dport 8000 -j ACCEPT
#Reply with proper ICMP error message and reject the connection
-A OUTPUT -j REJECT --reject-with icmp-host-prohibited
COMMIT
#+END_SRC
** COMMENT Create a =.wsgi= file
   *This step is taken care by analtyics service*
   To run your application you need a =analytics.wsgi= file.  This
   file contains the code =mod_wsgi= is executing on startup to get
   the application object.  The object called application in that file
   is then used as application.
   #+BEGIN_SRC yml :tangle roles/analytics_server/files/analytics.wsgi :eval no
   import sys 
   sys.path.insert (0,'/var/www/html/analytics/')
   import logging, sys
   logging.basicConfig(stream=sys.stderr)
   from app import app as application
   #+END_SRC

** =Apache= configuration for Web server gateway interface(WSGI)
#+BEGIN_SRC yml :tangle roles/analytics_server/files/analytics_http.conf :eval no
WSGIScriptAlias / /var/www/html/analytics/analytics.wsgi
WSGIScriptReloading On
<Directory /var/www/html/analytics>
     Order deny,allow
     Allow from all
 </Directory>
#+END_SRC

** Tasks 
   Following playbook has tasks to configure the node
#+BEGIN_SRC yml :tangle roles/analytics_server/tasks/main.yaml :eval no

# Install epel-release to get pip, and to install flask
- name: install http,epel-release, python-pip, mod_wsgi
  yum: name={{ item }} state=installed
  with_items:
   - epel-release
   - python-pip
   - mod_wsgi
   - httpd
   - git 
   - emacs
#Use pip to install Flask, Flask-Cache
- name: install Flask, Flask-Cache using pip
  pip: name={{item}} state=present
  with_items:
   - Flask
   - Flask-Cache
- name: Configure firewall rules
  template: src=analytics_server_iptables dest=/etc/sysconfig/iptables owner=root group=root mode=0600
  notify:
   - restart iptables

#Copying the RP public key, to allow passwordless rsync of AWstats 
- name: Copy the RP pub key to Analytics server
  authorized_key: user=root key="{{ lookup('file', 'rp_pub_key') }}" state=present

#Copy the analytics.wsgi file to http configuration under conf.d/
#- name: Copying analytics.wsgi to analytics server
#  copy: src=analytics.wsgi dest=/var/www/html/analytics/ 

#Copy the WSGI file to http configuration under conf.d/
- name: Copying analytics_http.conf to analytics server
  copy: src=analytics_http.conf dest=/etc/httpd/conf.d/analytics_http.conf
  notify:
   - restart apache
#+END_SRC
*** Setup org-mode8 
    In order to tangle the analytics service model, org-mode8 setup
    is required.
#+BEGIN_SRC yml :tangle roles/analytics_server/tasks/main.yaml :eval no
# Setup org-mode8 
- name: Creating ~/emacs/lisp/ directory 
  file: path=~/emacs/lisp state=directory
- name: Getting the org-mode-8 sources
  get_url: url=http://orgmode.org/org-8.2.10.tar.gz dest=~/emacs/lisp/
- name: Extracting the sources into ~/emacs/lisp/
  unarchive: src=~/emacs/lisp/org-8.2.10.tar.gz dest=~/emacs/lisp/
#+END_SRC
** Handlers
   Restart the services httpd and iptables if there are any changes in
   the configuration files. These handlers are called when associated
   tasks in =tasks/main.yaml= notifies to restart the services.

#+BEGIN_SRC yml :tangle roles/analytics_server/handlers/main.yaml :eval no
---
- name: restart iptables
  service: name=iptables state=restarted

- name: restart apache
  service: name=httpd state=restarted enabled=yes

#+END_SRC

** Configuration script for setting up analytics server.

#+BEGIN_SRC yml :tangle analytics_server.yaml :eval no
---
- name: This file configures the analytics server
  hosts: analytics_server
  remote_user: root

  vars:
    host_name: "analytics-server.{{prefix}}vlabs.ac.in"
    
  roles:
    - common
    - analytics_server
    - ossec_client
    - rsyslog_client
    - nagios_client

#+END_SRC
* COMMENT  Provision the analytics node (manually)
** Container/VM/Machine basic requirements
   + Operating System: centos-6.6
   + Architecture: x86_64
   + Memory: 256 MB
   + Disk space: 10 GB
** Steps to manually create a centos container 
   #+BEGIN_SRC 
   vzctl create 16133 --ostemplate centos-6-x86_64-point6 --ipadd 10.4.15.133 --diskspace 10G:15.0G --hostname stats-demo.vlabs.ac.in
   vzctl start 16133
   vzctl set 16133 --nameserver inherit --ram 256M --swap 512M --onboot yes --save
   #+END_SRC
** Export proxy Settings if network uses proxy
   #+BEGIN_SRC 
   export http_proxy="proxy.iiit.ac.in:8080"
   export https_proxy="proxy.iiit.ac.in:8080"
   #+END_SRC    
** Update the System
   In order to have a stable deployment server, it is crucial to keep
   things up-to-date and well maintained.  To ensure that we have the
   latest available versions of default applications, we need to
   update our system.  Run the following command to update your system
   #+BEGIN_SRC 
   sudo yum -y update
   #+END_SRC
** Install Epel-repo
   #+BEGIN_SRC 
   yum install epel-release -y
   #+END_SRC
** Install pip with yum command
   #+BEGIN_SRC 
   yum install -y python-pip
   #+END_SRC
** Install Flask
   Enter the following command to get Flask activated in your
   =virtualenv=
   #+BEGIN_SRC 
    pip install Flask
   #+END_SRC
** Install Flask-Cache
   #+BEGIN_SRC 
   pip install Flask-Cache
   #+END_SRC
** Install wsgi on CentOS using yum
   WSGI(Web Server Gateway Interface) is an interface between a web
   server and the application itself. It exists to ensure a
   standardized way between various servers and applications
   (frameworks) to work with each other, allowing interchangeability
   when necessary (e.g. switching from development to production
   environment).

   #+BEGIN_SRC 
   yum install mod_wsgi
   #+END_SRC

** Create a =.wsgi= file
   To run your application you need a =analytics.wsgi= file.  This
   file contains the code =mod_wsgi= is executing on startup to get
   the application object.  The object called application in that file
   is then used as application.
   #+BEGIN_SRC
   import sys 
   sys.path.insert (0,'/var/www/html/analytics/')
   import logging, sys
   logging.basicConfig(stream=sys.stderr)
   from app import app as application
    #+END_SRC
** Configure the Apache and deploy the service
   Configure Apache to load =mod_wsgi= module and your project in
   VirtualHost Insert the following lines in
   =/etc/httpd/conf/httpd.conf=
   #+BEGIN_SRC 
   WSGIScriptAlias / /var/www/html/analytics/analytics.wsgi
   WSGIScriptReloading On
   <Directory /var/www/html/analytics>
     Order deny,allow
     Allow from all
    </Directory>
   #+END_SRC
** Restart Apache
   #+BEGIN_SRC 
   service httpd restart
   #+END_SRC
** Test the service with end point.
   #+BEGIN_SRC 
   http://10.4.15.133/numberofhits
   #+END_SRC

* Test cases
** Test Case 01
*** Objective
    Test to setup analitcs server using analytics_server.yaml playbook
*** Apparatus
    1. Container in the cluster
    2. ansible playbook to setup analytics node
*** Procedure 
    1. Create the container with proper network configuration 
       #+BEGIN_SRC 
       vzctl create 1012 --ostemplate centos-6-x86_64-point6 --hostname analytics-server.base4.vlabs.ac.in 
       vzctl set 1012 --netif_add eth1,,,,base4br --save
       vzctl start 1012
       #+END_SRC
    2. Configure the network
      #+BEGIN_SRC 
       vim /etc/sysconfig/network-scripts/ifcfg-eth1    
      #+END_SRC
      #+BEGIN_SRC 
      DEVICE=eth1
      IPADDR=10.100.1.12
      NETMASK=255.255.252.0
      ONBOOT=yes
      BOOTPROTO=static
      NM_CONTROLLED=no
      GATEWAY=10.100.1.1
      #+END_SRC
    3. Restart the network
       #+BEGIN_SRC 
       service network start
       #+END_SRC
    4. Check the default gate (10.100.1.1). If not, add default gate
       way as 10.100.1.1. (Common role takes of adding it)
       #+BEGIN_SRC 
       route add default gw 10.100.1.1
       #+END_SRC
    5. Enable ssh access from config-server
    6. Add analytics server's ip to hosts file.
    7. Add pub-key of both RP of aws and http of IIIT  to analytics
       server
       Here: Adding public key of RP of amazon is taken care by
       common role. But  Adding public key of http container of IIIT
       to analytics server is manual step.
    7. Pull the updated sources of analytics node of systems-model
       repo
    8. Run make
*** Experiments
    - Run analytics_server.yaml file from config-server to setup
      analytics node
    - Cronjob rules are added in reverse proxy
    - Run cronjobs to rsync apache logs and awstats from revers proxy
      to analytics node.
      #+BEGIN_SRC 
      rsync -arR /var/lib/awstats root@10.100.1.12:/root/aws      
      rsync -arR /var/log/httpd root@10.100.1.12:/root/aws/
      #+END_SRC
*** Result
    Logs are getting stored in pertricular location of analytics node
*** Conclusion
    The node has been configure using ansible playbook. Installed
    dependencies required for analyitcs node.

** Test Case 02
*** Objective
    Test to check whether the cronjob on reverse proxy of aws cluster
    is able to rsync apache logs and awstats to analytics node or not
*** Apparatus
    - Reverse proxy on aws with cron jobs
    - Analytics node to get logs from reverse proxy node
*** Experiments
    - run the following commands from reverse proxy on aws
      #+BEGIN_SRC 
      rsync -arR /var/lib/awstats root@10.100.1.12:/root/aws/
      rsync -arR /var/log/httpd root@10.100.1.12:/root/aws/
      #+END_SRC
    - Look for awstats in =/root/aws/awstast= in analytics server
    - Look for apache logs in =/root/aws/httpd= in analytics server    
*** Result 
    Apache logs and awstats are being stored in analytics server
*** Conclusion
    Cronjobs added correctly and reverse proxy server is able to rsync
    apache logs and awstats to analytics server.
    
** Test Case 03
*** Objective 
    Test to check whether the cronjob on reverse proxy of IIIT
    infrastructure is able to rsync apache logs and awstats to
    analytics node or not
*** Apparatus
    - Reverse proxy on IIIT infrastructure with cron jobs
    - Analytics node to get logs from reverse proxy node
*** Experiments
    - Run the following commands from reverse proxy 
      #+BEGIN_SRC 
      rsync -azR -e "ssh -p 2222" /var/www/awstats/awstats* stats.vlabs.ac.in:/root/base/
      rsync -azR -e "ssh -p 2222" /var/log/httpd/* stats.vlabs.ac.in:/root/base/
      #+END_SRC
    - Look for awstats in =/root/base/= in analytics server
    - Look for apache logs in =/root/base/= in analytics server    
*** Result 
    Apache logs and awstats are being stored in analytics server
*** Conclusion
    Cronjobs added correctly and reverse proxy node is able to rsync
    apache logs and awstats to analytics server.
   
